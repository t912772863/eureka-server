一. 理解eureka的自我保护模式
当eureka进入自我保护模式时, 最直观的表现就是注册中心首页出现红色警告.
默认情况下, 如果eureka server在一定时间内没有收到某个微服务实例的心跳, eureka server将注销该实例(默认90秒),
但是当网络分区故障发生时, 微服务与eureka server之间无法正常通信, 以上行为就可能变的非常危险了, 因为微服务本身
可能是健康的, 此时本不应该注销该服务.
eureka通过"自我保护模式"来解决这个问题, 当eureka server在短时间内丢失过多客户端时(可能发生了分区故障), 那么这个
节点就会进入自我保护模式, 一旦进入该模式, eureka server就会保护服务注册表中的信息, 不再删除服务注册表中的数据
(也就是不会注销任何微服务). 当网络故障恢复后, 该eureka server节点会自动退出自我保护模式.
综上, 自我保护模式是一种应对网络异常的安全保护模式,
可以通过eureka.server.enable-self-preservation = false禁用该模式